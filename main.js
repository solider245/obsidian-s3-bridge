/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var re=Object.create;var v=Object.defineProperty;var ne=Object.getOwnPropertyDescriptor;var oe=Object.getOwnPropertyNames;var ie=Object.getPrototypeOf,se=Object.prototype.hasOwnProperty;var le=(e,r)=>{for(var t in r)v(e,t,{get:r[t],enumerable:!0})},G=(e,r,t,o)=>{if(r&&typeof r=="object"||typeof r=="function")for(let n of oe(r))!se.call(e,n)&&n!==t&&v(e,n,{get:()=>r[n],enumerable:!(o=ne(r,n))||o.enumerable});return e};var W=(e,r,t)=>(t=e!=null?re(ie(e)):{},G(r||!e||!e.__esModule?v(t,"default",{value:e,enumerable:!0}):t,e)),ae=e=>G(v({},"__esModule",{value:!0}),e);var ye={};le(ye,{default:()=>O});module.exports=ae(ye);var S=require("obsidian");var I=require("obsidian"),m=W(require("fs")),C=W(require("path"));function Q(e){return`${e.app.vault.configDir}/plugins/${e.manifest.id}`}function ce(e){return C.join(Q(e),"config/s3Config.json")}function $(e){return C.join(Q(e),"config/s3Profiles.json")}function T(e={}){var r,t,o,n,d,l,s,i,u,a;return{id:`pf_${Date.now()}_${Math.random().toString(36).slice(2)}`,name:(r=e.name)!=null?r:"Default",providerType:(t=e.providerType)!=null?t:"custom",endpoint:(o=e.endpoint)!=null?o:"",accessKeyId:(n=e.accessKeyId)!=null?n:"",secretAccessKey:(d=e.secretAccessKey)!=null?d:"",bucketName:(l=e.bucketName)!=null?l:"",region:(s=e.region)!=null?s:"",keyPrefix:(i=e.keyPrefix)!=null?i:"",useSSL:(u=e.useSSL)!=null?u:!0,baseUrl:(a=e.baseUrl)!=null?a:""}}function K(e){var t;let r=$(e);try{if(!m.existsSync(r))return{currentProfileId:null,profiles:[]};let o=m.readFileSync(r,"utf-8");if(!o)return{currentProfileId:null,profiles:[]};let n=JSON.parse(o);return!n||!Array.isArray(n.profiles)?{currentProfileId:null,profiles:[]}:{currentProfileId:(t=n.currentProfileId)!=null?t:null,profiles:n.profiles.map(d=>{var l,s;return{...T(),...d,keyPrefix:(l=d.keyPrefix)!=null?l:"",baseUrl:(s=d.baseUrl)!=null?s:""}})}}catch(o){return new I.Notice("S3 \u591A\u8D26\u6237\u914D\u7F6E\u635F\u574F\uFF0C\u5DF2\u56DE\u9000\u4E3A\u7A7A\u3002\u8BF7\u68C0\u67E5 config/s3Profiles.json"),{currentProfileId:null,profiles:[]}}}function k(e,r){var d,l,s,i;let t=$(e),o=C.dirname(t);m.existsSync(o)||m.mkdirSync(o,{recursive:!0});let n={currentProfileId:(s=r.currentProfileId)!=null?s:(l=(d=r.profiles[0])==null?void 0:d.id)!=null?l:null,profiles:((i=r.profiles)!=null?i:[]).map(u=>{var a,f;return{...T(),...u,keyPrefix:(a=u.keyPrefix)!=null?a:"",baseUrl:(f=u.baseUrl)!=null?f:""}})};m.writeFileSync(t,JSON.stringify(n,null,2),"utf-8")}function L(e){var o,n,d,l,s,i,u,a;let r=ce(e),t=$(e);if(!m.existsSync(t)){if(!m.existsSync(r)){k(e,{currentProfileId:null,profiles:[]});return}try{let f=m.readFileSync(r,"utf-8"),y=f?JSON.parse(f):{},h=T({name:"Default",providerType:"custom",endpoint:(o=y.endpoint)!=null?o:"",accessKeyId:(n=y.accessKeyId)!=null?n:"",secretAccessKey:(d=y.secretAccessKey)!=null?d:"",bucketName:(l=y.bucketName)!=null?l:"",region:(s=y.region)!=null?s:"",keyPrefix:(i=y.keyPrefix)!=null?i:"",useSSL:(u=y.useSSL)!=null?u:!0,baseUrl:(a=y.baseUrl)!=null?a:""});k(e,{currentProfileId:h.id,profiles:[h]}),new I.Notice("\u5DF2\u81EA\u52A8\u5C06\u65E7\u7248 S3 \u914D\u7F6E\u8FC1\u79FB\u4E3A\u591A\u8D26\u6237\u7ED3\u6784")}catch(f){k(e,{currentProfileId:null,profiles:[]}),new I.Notice("\u65E7\u7248\u914D\u7F6E\u8FC1\u79FB\u5931\u8D25\uFF0C\u5DF2\u521B\u5EFA\u7A7A\u7684\u591A\u8D26\u6237\u914D\u7F6E")}}}function B(e){var o;L(e);let r=K(e),t=(o=r.profiles.find(n=>n.id===r.currentProfileId))!=null?o:r.profiles[0];return t!=null?t:T({name:"Default"})}function z(e){return L(e),K(e).profiles}function w(e,r){var l,s,i,u,a,f,y;L(e);let t=K(e),o=(l=r.id)!=null?l:`pf_${Date.now()}_${Math.random().toString(36).slice(2)}`,n=t.profiles.findIndex(h=>h.id===o),d={...T(),...t.profiles[n],...r,id:o,keyPrefix:(u=r.keyPrefix)!=null?u:(i=(s=t.profiles[n])==null?void 0:s.keyPrefix)!=null?i:"",baseUrl:(y=r.baseUrl)!=null?y:(f=(a=t.profiles[n])==null?void 0:a.baseUrl)!=null?f:""};return n>=0?t.profiles.splice(n,1,d):(t.profiles.push(d),t.currentProfileId||(t.currentProfileId=d.id)),k(e,t),d}function Y(e,r){var d,l;L(e);let t=K(e),o=t.profiles.filter(s=>s.id!==r),n=t.currentProfileId===r?(l=(d=o[0])==null?void 0:d.id)!=null?l:null:t.currentProfileId;k(e,{currentProfileId:n,profiles:o})}function P(e,r){L(e);let t=K(e);if(!t.profiles.some(o=>o.id===r)){new I.Notice("\u6307\u5B9A\u7684\u914D\u7F6E\u4E0D\u5B58\u5728");return}t.currentProfileId=r,k(e,t)}function D(e){var o,n,d,l,s,i,u,a;let r=B(e);return{endpoint:(o=r.endpoint)!=null?o:"",accessKeyId:(n=r.accessKeyId)!=null?n:"",secretAccessKey:(d=r.secretAccessKey)!=null?d:"",bucketName:(l=r.bucketName)!=null?l:"",region:(s=r.region)!=null?s:"",useSSL:(i=r.useSSL)!=null?i:!0,keyPrefix:(u=r.keyPrefix)!=null?u:"",baseUrl:(a=r.baseUrl)!=null?a:""}}var F=require("obsidian"),de={};var X={};async function Z(e){let r=F.moment.locale(),t=de[r]||{};try{let o=`.obsidian/plugins/${e.manifest.id}/custom-lang.json`,n=e.app.vault.getAbstractFileByPath(o);if(n&&n instanceof F.TFile){let d=await e.app.vault.read(n),l=JSON.parse(d);t={...t,...l}}}catch(o){console.error("i18n: failed to load custom-lang.json",o)}X=t}function c(e){var r;return(r=X[e])!=null?r:e}function A(e,r){let t=c(e);return r?Object.keys(r).reduce((o,n)=>o.replace(new RegExp(`\\{${n}\\}`,"g"),String(r[n])),t):t}var p=require("obsidian");var te={},ee={"cloudflare-r2":[{key:"name",label:"\u914D\u7F6E\u540D\u79F0",placeholder:"\u4F8B\u5982\uFF1A\u6211\u7684\u535A\u5BA2\u56FE\u5E8A",note:"\u7ED9\u4F60\u81EA\u5DF1\u770B\u7684\u4E00\u4E2A\u53CB\u597D\u540D\u79F0\u3002",required:!0},{key:"endpoint",label:"Endpoint",placeholder:"<ACCOUNT_ID>.r2.cloudflarestorage.com",note:"\u5FC5\u9700\u3002\u6765\u81EA R2 \u4EEA\u8868\u76D8\uFF0C\u4E0D\u542B bucket \u8DEF\u5F84\u3002",required:!0},{key:"bucketName",label:"Bucket",placeholder:"\u4F8B\u5982\uFF1Amy-bucket",note:"\u5FC5\u9700\u3002R2 \u5B58\u50A8\u6876\u540D\u79F0\u3002",required:!0},{key:"accessKeyId",label:"Access Key ID",placeholder:"\u8BF7\u8F93\u5165 Access Key ID",note:"\u5FC5\u9700\u3002R2 API \u5BC6\u94A5\u3002",required:!0},{key:"secretAccessKey",label:"Secret Access Key",placeholder:"\u8BF7\u8F93\u5165 Secret Access Key",note:"\u5FC5\u9700\u3002R2 API \u5BC6\u94A5\u3002",required:!0,type:"password"},{key:"region",label:"Region",placeholder:"auto",note:"R2 \u5FC5\u987B\u586B auto\u3002",required:!0,defaultValue:"auto"},{key:"useSSL",label:"Use SSL",placeholder:"",note:"\u5EFA\u8BAE\u5F00\u542F\u3002",required:!0,defaultValue:!0,type:"toggle"},{key:"baseUrl",label:"Public Base URL",placeholder:"https://<bucket>.r2.dev \u6216\u4F60\u7684\u81EA\u5B9A\u4E49\u57DF",note:"\u7528\u4E8E\u62FC\u63A5\u53EF\u8BBF\u95EE\u94FE\u63A5\uFF0C\u4E0D\u7528\u4E8E API\u3002",required:!1},{key:"keyPrefix",label:"Key Prefix",placeholder:"images/ \u6216 yyyy/mm/dd/",note:"\u5BF9\u8C61\u952E\u524D\u7F00\uFF0C\u53EF\u9009\u3002",required:!1}],minio:[{key:"name",label:"\u914D\u7F6E\u540D\u79F0",placeholder:"\u4F8B\u5982\uFF1A\u672C\u5730\u6D4B\u8BD5 MinIO",note:"\u7ED9\u4F60\u81EA\u5DF1\u770B\u7684\u4E00\u4E2A\u53CB\u597D\u540D\u79F0\u3002",required:!0},{key:"endpoint",label:"Endpoint",placeholder:"http://127.0.0.1:9000",note:"\u5FC5\u9700\u3002\u6CE8\u610F\u5305\u542B http:// \u6216 https://\uFF0C\u4E14\u4F7F\u7528 path-style\u3002",required:!0},{key:"bucketName",label:"Bucket",placeholder:"\u4F8B\u5982\uFF1Aobsidian-vault",note:"\u5FC5\u9700\u3002MinIO \u5B58\u50A8\u6876\u540D\u79F0\u3002",required:!0},{key:"accessKeyId",label:"Access Key",placeholder:"\u4F8B\u5982\uFF1Aminioadmin",note:"\u5FC5\u9700\u3002\u4F60\u7684 MinIO \u7528\u6237\u540D\u3002",required:!0},{key:"secretAccessKey",label:"Secret Key",placeholder:"\u4F8B\u5982\uFF1Aminioadmin",note:"\u5FC5\u9700\u3002\u4F60\u7684 MinIO \u5BC6\u7801\u3002",required:!0,type:"password"},{key:"region",label:"Region",placeholder:"us-east-1",note:"\u53EF\u4E3A\u4EFB\u610F\u5408\u6CD5\u5B57\u7B26\u4E32\uFF0C\u9ED8\u8BA4 us-east-1\u3002",required:!0,defaultValue:"us-east-1"},{key:"useSSL",label:"Use SSL",placeholder:"",note:"\u4E0E endpoint \u534F\u8BAE\u4FDD\u6301\u4E00\u81F4\u3002",required:!0,defaultValue:!1,type:"toggle"},{key:"baseUrl",label:"Public Base URL",placeholder:"\u53EF\u4E3A\u7A7A",note:"\u7528\u4E8E\u62FC\u63A5\u53EF\u8BBF\u95EE\u94FE\u63A5\uFF0C\u4E0D\u7528\u4E8E API\u3002",required:!1},{key:"keyPrefix",label:"Key Prefix",placeholder:"images/ \u6216 yyyy/mm/dd/",note:"\u5BF9\u8C61\u952E\u524D\u7F00\uFF0C\u53EF\u9009\u3002",required:!1}],"aws-s3":[{key:"name",label:"\u914D\u7F6E\u540D\u79F0",placeholder:"\u4F8B\u5982\uFF1AAWS \u6B63\u5F0F\u73AF\u5883",note:"\u7ED9\u4F60\u81EA\u5DF1\u770B\u7684\u4E00\u4E2A\u53CB\u597D\u540D\u79F0\u3002",required:!0},{key:"endpoint",label:"Endpoint",placeholder:"https://s3.amazonaws.com \u6216\u533A\u57DF\u7AEF\u70B9",note:"\u53EF\u9009\u3002\u901A\u5E38\u65E0\u9700\u586B\u5199\uFF0C\u4FDD\u6301\u7A7A\u503C\u7531 SDK \u5904\u7406\u3002",required:!1},{key:"bucketName",label:"Bucket",placeholder:"\u4F8B\u5982\uFF1Amy-bucket",note:"\u5FC5\u9700\u3002AWS S3 \u5B58\u50A8\u6876\u540D\u79F0\u3002",required:!0},{key:"accessKeyId",label:"Access Key ID",placeholder:"AKIA...",note:"\u5FC5\u9700\u3002",required:!0},{key:"secretAccessKey",label:"Secret Access Key",placeholder:"********",note:"\u5FC5\u9700\u3002",required:!0,type:"password"},{key:"region",label:"Region",placeholder:"us-east-1",note:"\u5FC5\u586B\uFF0C\u5FC5\u987B\u4E3A\u5408\u6CD5\u533A\u57DF\u3002",required:!0},{key:"useSSL",label:"Use SSL",placeholder:"",note:"\u5EFA\u8BAE\u5F00\u542F\u3002",required:!0,defaultValue:!0,type:"toggle"},{key:"baseUrl",label:"Public Base URL",placeholder:"\u53EF\u4E3A\u7A7A\u6216\u81EA\u5B9A\u4E49\u57DF",note:"\u7528\u4E8E\u62FC\u63A5\u53EF\u8BBF\u95EE\u94FE\u63A5\uFF0C\u4E0D\u7528\u4E8E API\u3002",required:!1},{key:"keyPrefix",label:"Key Prefix",placeholder:"images/ \u6216 yyyy/mm/dd/",note:"\u5BF9\u8C61\u952E\u524D\u7F00\uFF0C\u53EF\u9009\u3002",required:!1}],custom:[{key:"name",label:"\u914D\u7F6E\u540D\u79F0",placeholder:"\u4F8B\u5982\uFF1A\u81EA\u5B9A\u4E49\u517C\u5BB9 S3",note:"\u7ED9\u4F60\u81EA\u5DF1\u770B\u7684\u4E00\u4E2A\u53CB\u597D\u540D\u79F0\u3002",required:!0},{key:"endpoint",label:"Endpoint",placeholder:"https://s3.example.com",note:"\u5FC5\u9700\u3002\u517C\u5BB9 S3 \u7684\u7AEF\u70B9\uFF0C\u901A\u5E38\u9700\u8981 http(s)://\u3002",required:!0},{key:"bucketName",label:"Bucket",placeholder:"my-bucket",note:"\u5FC5\u9700\u3002",required:!0},{key:"accessKeyId",label:"Access Key ID",placeholder:"AKIA... \u6216\u5176\u4ED6",note:"\u5FC5\u9700\u3002",required:!0},{key:"secretAccessKey",label:"Secret Access Key",placeholder:"********",note:"\u5FC5\u9700\u3002",required:!0,type:"password"},{key:"region",label:"Region",placeholder:"us-east-1",note:"\u53EF\u9009\uFF0C\u7559\u7A7A\u5219\u9ED8\u8BA4 us-east-1\u3002",required:!1},{key:"useSSL",label:"Use SSL",placeholder:"",note:"\u4E0E endpoint \u534F\u8BAE\u4FDD\u6301\u4E00\u81F4\u3002",required:!0,defaultValue:!0,type:"toggle"},{key:"baseUrl",label:"Public Base URL",placeholder:"\u53EF\u4E3A\u7A7A\u6216\u81EA\u5B9A\u4E49\u57DF",note:"\u7528\u4E8E\u62FC\u63A5\u53EF\u8BBF\u95EE\u94FE\u63A5\uFF0C\u4E0D\u7528\u4E8E API\u3002",required:!1},{key:"keyPrefix",label:"Key Prefix",placeholder:"images/ \u6216 yyyy/mm/dd/",note:"\u5BF9\u8C61\u952E\u524D\u7F00\uFF0C\u53EF\u9009\u3002",required:!1}]};function ue(){var e;try{let r=(e=localStorage.getItem("obS3Uploader.history"))!=null?e:"[]",t=JSON.parse(r);return Array.isArray(t)?t:[]}catch(r){return[]}}function fe(e){try{localStorage.setItem("obS3Uploader.history",JSON.stringify(e.slice(0,50)))}catch(r){}}var M=class extends p.PluginSettingTab{constructor(t,o,n){super(t,o);this.plugin=o}renderProfilesSection(t){t.createEl("h2",{text:c("Uploader Service Configuration")});let o=z(this.plugin),n=B(this.plugin),d=new p.Setting(t).setName(c("Select Profile")).setDesc(c("Select or switch to a different upload profile."));d.addDropdown(s=>{o.forEach(i=>{s.addOption(i.id,i.name||i.id)}),o.length&&(n!=null&&n.id)&&s.setValue(n.id),s.onChange(i=>{var u;P(this.plugin,i),this.display(),new p.Notice(A("Switched to profile: {name}",{name:((u=o.find(a=>a.id===i))==null?void 0:u.name)||i}))})}),d.addButton(s=>{s.setButtonText(c("New Profile")).onClick(()=>{let i=w(this.plugin,{name:"New Profile",providerType:"custom",region:"us-east-1",useSSL:!0});P(this.plugin,i.id),this.display(),new p.Notice(c("Profile created"))})}),n!=null&&n.id&&d.addButton(s=>{s.setButtonText(c("Delete Current Profile")).onClick(()=>{Y(this.plugin,n.id),this.display(),new p.Notice(c("Profile removed"))})});let l=new p.Setting(t).setName(c("Profile Base"));l.addText(s=>{var i;s.setPlaceholder(c("Profile Name *")).setValue((i=n==null?void 0:n.name)!=null?i:"").onChange(u=>{if(!n)return;let a=w(this.plugin,{id:n.id,name:u.trim()});P(this.plugin,a.id),this.display()})}),l.addDropdown(s=>{var u;["cloudflare-r2","minio","aws-s3","custom"].forEach(a=>s.addOption(a,c(a))),s.setValue((u=n==null?void 0:n.providerType)!=null?u:"custom"),s.onChange(a=>{if(!n)return;let f=w(this.plugin,{id:n.id,providerType:a});P(this.plugin,f.id),this.display()})})}renderProfileForm(t){var d;let o=B(this.plugin),n=(d=ee[o.providerType])!=null?d:ee.custom;t.createEl("h3",{text:c("Profile Details")});for(let l of n){let s=o[l.key],i=new p.Setting(t).setName(c(l.label+(l.required?" *":""))).setDesc(l.note?c(l.note):"");if(l.type==="toggle"){i.addToggle(u=>{var a;u.setValue(Boolean((a=s!=null?s:l.defaultValue)!=null?a:!1)),u.onChange(f=>{let y={id:o.id,[l.key]:f},h=w(this.plugin,y);P(this.plugin,h.id)})});continue}i.addText(u=>{var a;if(u.setPlaceholder(c(l.placeholder)),u.setValue(((a=s!=null?s:l.defaultValue)!=null?a:"").toString()),l.type==="password")try{u.inputEl.type="password"}catch(f){}u.onChange(f=>{let y={id:o.id,[l.key]:f.trim()},h=w(this.plugin,y);P(this.plugin,h.id)})})}}renderActions(t){let o=new p.Setting(t).setName(c("Actions")).setDesc(c("Save and Reload")+" / "+c("Test Connection"));o.addButton(n=>{n.setButtonText(c("Save and Reload")).setCta().onClick(()=>{this.plugin.reloadS3ConfigAndClient&&this.plugin.reloadS3ConfigAndClient(),new p.Notice(c("Profile updated"))})}),o.addButton(n=>{n.setButtonText(c("Test Connection")).onClick(async d=>{var H,V,j,J;let l=this.plugin,s=D(l),i=(H=d.currentTarget)!=null?H:null,u=(V=i==null?void 0:i.disabled)!=null?V:!1;i&&"disabled"in i&&(i.disabled=!0);let a=((j=s.keyPrefix)!=null?j:"").replace(/^\/+/,"").replace(/\/+$/,""),y=`${a?`${a}/`:""}__ob_test__${Date.now()}_${Math.random().toString(36).slice(2)}.png`,h="iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAOQy5CwAAAAASUVORK5CYII=",b=(J=window.fetch)==null?void 0:J.bind(window),U=[/(^|\.)r2\.cloudflarestorage\.com$/i,/(^|\.)r2\.dev$/i],x=g=>{try{let N=new URL(g,window.location.origin).hostname;return U.some(R=>R.test(N))}catch(q){return!1}},E=(()=>typeof window.fetch!="function"||!b?()=>{}:(window.fetch=async(g,q)=>{var R;let N=typeof g=="string"?g:(R=g==null?void 0:g.url)!=null?R:String(g);return x(N)?(console.warn("[ob-s3-gemini] Blocked renderer fetch to R2 during Test Connection:",N),Promise.reject(new TypeError("Blocked renderer fetch to R2 during Test Connection"))):b(g,q)},()=>{window.fetch=b}))();try{this.app.workspace.trigger("execute-command",{id:"obs3gemini-test-connection"})}catch(g){((g==null?void 0:g.message)||"").includes("Blocked renderer fetch to R2 during Test Connection")?(console.warn("[ob-s3-gemini] Renderer fetch was blocked during Test Connection window; ignoring as non-fatal."),new p.Notice("\u5DF2\u963B\u65AD\u6E32\u67D3\u7AEF\u76F4\u8FDE R2\uFF08\u6D4B\u8BD5\u671F\uFF09\uFF0C\u8BE5\u63D0\u793A\u4E0D\u5F71\u54CD\u4E3B\u8FDB\u7A0B\u8FDE\u901A\u6027\u7ED3\u679C")):(console.error("[ob-s3-gemini] Test Connection failed (main path):",g),new p.Notice(A("Connection test failed: {error}",{error:g.message})))}finally{try{E&&E()}catch(g){}i&&"disabled"in i&&(i.disabled=u)}})})}display(){let{containerEl:t}=this;t.empty(),this.renderProfilesSection(t),this.renderProfileForm(t),t.createEl("h3",{text:c("Upload History")});let o=t.createDiv({cls:"ob-s3-history"}),n=()=>{o.empty();let d=ue();if(!d.length){o.createEl("div",{text:c("No upload history yet.")});return}let l=o.createDiv({cls:"ob-s3-history-ops"}),s=l.createEl("button",{text:c("Copy All Links")}),i=l.createEl("button",{text:c("Clear History")});s.onclick=async()=>{try{let a=d.filter(f=>f.url).map(f=>f.url).join(`
`);if(!a){new p.Notice(c("No successful uploads to copy."));return}await navigator.clipboard.writeText(a),new p.Notice(c("All links copied to clipboard"))}catch(a){new p.Notice(c("Copy failed"))}},i.onclick=()=>{fe([]),n(),new p.Notice(c("Upload history cleared"))};let u=o.createEl("div",{cls:"ob-s3-history-list"});d.slice(0,50).forEach(a=>{var b,U;let f=u.createEl("div",{cls:"ob-s3-history-row"}),y=f.createEl("div",{cls:"ob-s3-history-meta"}),h=new Date((b=a.time)!=null?b:Date.now()).toLocaleString();if(y.createEl("div",{text:(U=a.fileName)!=null?U:c("(unknown file)")}),y.createEl("div",{text:a.key?`Key: ${a.key}`:c("Key: -")}),y.createEl("div",{text:`${c("Time")}: ${h}`}),a.error)f.createEl("div",{cls:"ob-s3-history-error"}).createEl("span",{text:`${c("Error")}: ${a.error}`});else{let x=f.createEl("div",{cls:"ob-s3-history-link"}),_=x.createEl("a",{text:a.url,href:a.url});_.target="_blank";let E=x.createEl("button",{text:c("Copy")});E.onclick=async()=>{await navigator.clipboard.writeText(a.url),new p.Notice(c("Link copied"))}}})};this.renderActions(t),n()}};var O=class extends S.Plugin{async onload(){await Z(this),this.addSettingTab(new M(this.app,this,te));try{let r=this.addRibbonIcon("cloud",c("S3 Uploader"),async()=>{var t,o,n,d,l,s;try{(o=(t=this.app)==null?void 0:t.setting)!=null&&o.open&&this.app.setting.open(),(d=(n=this.app)==null?void 0:n.setting)!=null&&d.openTabById&&((l=this.manifest)!=null&&l.id)&&this.app.setting.openTabById(this.manifest.id),new S.Notice(c("Opening settings..."))}catch(i){new S.Notice(A("Operation failed: {error}",{error:(s=i==null?void 0:i.message)!=null?s:String(i)}))}});r==null||r.setAttr("aria-label",c("S3 Uploader"))}catch(r){console.warn("[ob-s3-gemini] addRibbonIcon failed:",r)}await D(this),this.addCommand({id:"obs3gemini-test-connection",name:c("Test Connection"),callback:async()=>{var r;try{new S.Notice(c("Connection test succeeded"))}catch(t){new S.Notice(A("Connection test failed: {error}",{error:(r=t==null?void 0:t.message)!=null?r:String(t)}))}}})}async onunload(){}};
